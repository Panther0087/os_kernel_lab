# 实验指导一

## 实验概要

这一章的实验指导中，我们将会学习

- RISC-V 中有关中断处理的寄存器和相关流程
- 如何保存上下文，使得中断处理流程前后，原本正在执行的程序感知不到发生了中断
- 处理最简单的断点中断和时钟中断
- 实验题：TODO

## 实验说明

中断是我们在操作系统上首先实现的功能，因为它是操作系统所有功能的基础。假如没有中断，操作系统在唤起一个用户程序之后，就只能等到用户程序执行完成之后才能继续执行，那操作系统完全无法进行资源调度。

在我们的框架中，中断的处理过程是这样的：

0.  操作系统初始化时，开启中断
1.  程序执行触发中断，或硬件发生中断
2.  硬件检查操作系统设置的中断使能（`sie`），如果中断使能打开，则进入中断
3.  硬件根据 `stvec` 中的值找到中断处理函数入口，它被我们设置为 `__interrupt` 汇编标签的地址
4.  `__interrupt` 保存各种寄存器，然后调用 `handle_interrupt` 根据不同的中断类型进行处理
5.  处理完成后，执行 `__restore`，恢复各种寄存器
6.  最终，通过 `sret` 指令跳转至 `sepc` 寄存器保存的值
